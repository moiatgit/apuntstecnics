<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Apunts tècnics: JDBC I. Introducció</title>
<meta name="description" content="">
<meta name="author" content="Moisès Gómez Girón">

<!-- HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
        <script src="./theme/html5.js"></script>
    <![endif]-->

<!-- Styles -->
<link href="./theme/bootstrap.moi.css" rel="stylesheet">
<link href="./theme/local.css" rel="stylesheet">
<link href="./theme/pygments.css" rel="stylesheet">

<!-- Feeds -->
<link href="http://apuntstecnics.herokuapp.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Apunts tècnics Atom Feed" />

</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <div class="container-fluid">
            <a class="brand" href="./">[Apunts tècnics]
 JDBC I. Introducció             </a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="sidebar">
        <div class="well">
            <!--
            <h3>Temes</h3>
                <ul>
                </ul>
            -->
            <h3>Categories</h3>
            <ul>
                <li class="active"><a href="./category/bd.html">bd</a></li>
                <li ><a href="./category/dev.html">dev</a></li>
                <li ><a href="./category/eines.html">eines</a></li>
                <li ><a href="./category/misc.html">misc</a></li>
                <li ><a href="./category/poo.html">poo</a></li>
                <li ><a href="./category/programacio.html">programacio</a></li>
                <li ><a href="./category/uml.html">uml</a></li>
            </ul>
            <h3>Tags</h3>
            <ul>
                <li><a href="./tag/c.html">C</a></li>
                <li><a href="./tag/java.html">java</a></li>
                <li><a href="./tag/programari.html">programari</a></li>
                <li><a href="./tag/util.html">util</a></li>
                <li><a href="./tag/test.html">test</a></li>
                <li><a href="./tag/postgresql.html">PostGreSQL</a></li>
            </ul>
        </div>
    </div>

    <div class="content">
<div class='article'>
<div class="well small">
<ul id="navigation"> 


    <li class="navigation-next">
    <a href="./jdbc-ii-model-relacional.html">
        JDBC II. Model relacional
    </a>
    </li>
</ul> 
</div>
    <div class="page-header"><h1>JDBC I. Introducció</h1></div>
<div class="well small">
    Entrada ubicada a la categoria
    <a href="./category/bd.html">
        bd
    </a>
            amb els tags: 
            <a href="./tag/postgresql.html">PostGreSQL</a> 
            <a href="./tag/java.html">java</a> 
</div>
    <div><div class="section" id="introducio">
<h2>Introdució</h2>
<p>Amb aquests continguts treballarem la manera de comunicar els nostres
programes orientats a objecte amb les nostres bases de dades objecte
relacionals.</p>
<p>Les tecnologies concretes que farem servir són el JDK 7 i PostGreSQL
9.1 <a class="footnote-reference" href="#potseraltrestambe" id="id1">[1]</a>. Els continguts pressuposen que tens prou
nocions d'aquestes dues tecnologies.</p>
<p>A aquesta primera part, s'introdueix el JDBC, la seva instal·lació i
unes primeres nocions d'ús. A la segona part analitzarem, a partir
d'exemples, el funcionament del JDBC amb un model purament relacional.
Finalment, la tercera part d'aquest document analitzarà la comunicació
amb les diferents característiques objecte-relacional que ens ofereix
PostGreSQL.</p>
<p>Els exercicis que hi apareixen inclouen una marca (un asterisc) quan
es tracta d'un exercici d'ampliació. Sense marca, l'exercici està
dissenyat per què disposis d'una referència bàsica de que has entès
els continguts.</p>
</div>
<div class="section" id="introduccio-al-jdbc">
<h2>Introduccio al JDBC</h2>
<div class="section" id="que-es-jdbc">
<h3>Què és JDBC?</h3>
<p>Segons la definició que apareix a la documentació oficial de Java per
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/technotes/guides/jdbc/">JDBC</a>:</p>
<blockquote>
The Java Database Connectivity (JDBC) API provides universal data
access from the Java programming language. Using the JDBC API, you
can access virtually any data source, from relational databases to
spreadsheets and flat files. JDBC technology also provides a
common base on which tools and alternate interfaces can be built.</blockquote>
<p>Amb JDBC, per tant, disposem d'un conjunt d'<em>interfaces</em> i alguna
classe completa que ens permetrà comunicar-nos amb el SGBD (entre
altres fonts de dades) Per si sol, no podrem fer gaire cosa, fins que
disposem d'una implementació concreta i adequada pel nostre SGBD. A
aquesta implementació se la coneix com a <em>driver</em>. Si el <em>driver</em>
implementa correctament la interfície, el codi que desenvolupem
fent-la servir, hauria de funcionar (sense comptar les sentències sql)
per altres fonts de dades que implementin el JDBC.</p>
</div>
<div class="section" id="installacio">
<h3>Instal·lació</h3>
<p>Descarrega la darrera versió del <em>driver</em> de PostGreSQL per JDBC de
<a class="reference external" href="http://jdbc.postgresql.org/">jdbc.postgresql.org</a></p>
<p>En el moment en que s'escriu aquest document la darrera versió
correspon a <a class="reference external" href="http://jdbc.postgresql.org/download/postgresql-9.2-1002.jdbc4.jar">postgresql-9.2-1002.jdbc4.jar</a>.</p>
<p>Deixa el fitxer descarregat a un directori que recordis i configura el
<tt class="docutils literal">CLASSPATH</tt> per què java el pugui trobar.</p>
</div>
<div class="section" id="hola-jdbc">
<h3>Hola JDBC!</h3>
<p>Considera el següent codi que:</p>
<ol class="arabic">
<li><p class="first">importa les classes del JDBC</p>
</li>
<li><p class="first">composa la cadena de connexió</p>
<p>Fixat que aquest és l'únic punt on apareix alguna referència a
PostGreSQL. La resta del codi no hauria de requerir canvis si
decidíssim canviar de SGBD.</p>
</li>
<li><p class="first">realitza la connexió</p>
</li>
<li><p class="first">tanca la connexió</p>
</li>
</ol>
<pre class="literal-block">
import java.sql.*;  // (1) importa les classes del JDBC
public class HolaPG {
    public static void main(String[] args) {
        // components de la cadena de connexió
        String usuari   = &quot;usuaribd&quot;;
        String password = &quot;pass&quot;;
        String host     = &quot;192.168.56.101&quot;;
        String bd       = &quot;testbd&quot;;

        String cadenaConnexio // (2) composa la cadena de connexió
            = &quot;jdbc:postgresql://&quot; + host
            + &quot;/&quot;                + bd
            + &quot;?user=&quot;           + usuari
            + &quot;&amp;password=&quot;       + password;

        // connexió
        Connection conn=null;
        try {
            // (3) realitza la connexió
            conn = DriverManager.getConnection(cadenaConnexio);
            System.out.println(&quot;Connectat a la base de dades &quot; + bd);
        } catch (SQLException e) {
            System.out.println(&quot;ERROR: no s'ha pogut connectar: &quot; + e);
        } finally {
            try{
                if (conn!=null) conn.close(); // (4) tanca la connexió
            } catch (Exception e) {
                System.out.println(&quot;ERROR: no s'ha pogut desconnectar: &quot; + e);
            }
        }
    }
}
</pre>
</div>
<div class="section" id="consultes">
<h3>Consultes</h3>
<p>Per llençar una consulta (<em>query</em>) a la base de dades, JDBC ens
ofereix les classes <tt class="docutils literal">Statement</tt> i <tt class="docutils literal">PreparedStatement</tt>.</p>
<p>Considera el següent codi que:</p>
<ol class="arabic">
<li><p class="first">fa servir la classe <em>java.util.Properties</em></p>
<p>per emmagatzemar les dades <em>sensibles</em> (usuari i password).</p>
<p>Amb <tt class="docutils literal">Properties</tt> podem, per exemple, disposar de les dades en
algun fitxer extern al nostre codi, probablement protegit i <em>fora</em>
del control de versions.</p>
</li>
<li><p class="first">considerem un mètode per a <em>amagar</em> tots els detalls de connexió:
el <tt class="docutils literal">connecta()</tt>.</p>
</li>
<li><p class="first">crea el <em>Statement</em> que permetrà llençar una comanda sql i recollir
el resultat de la seva interpretació pel SGBD.</p>
</li>
<li><p class="first">crea el <em>ResultSet</em> que contindrà el resultat obtingut d'una
commanda.</p>
</li>
<li><p class="first">recupera el resultat</p>
</li>
<li><p class="first">tanca els recursos</p>
</li>
</ol>
<pre class="literal-block">
import java.sql.*;
import java.util.Properties;
public class SgbdVersion {
    /* (2) realitza la connexió i la retorna */
    static Connection connecta() throws SQLException {
        // (1) construcció del conjunt de Properties
        Properties prop = new Properties();
        prop.put(&quot;user&quot;,  &quot;usuaribd&quot;);
        prop.put(&quot;password&quot;,  &quot;pass&quot;);
        String host = &quot;192.168.56.101&quot;;
        String bd   = &quot;testbd&quot;;
        String cadenaConnexio = &quot;jdbc:postgresql://&quot; + host + &quot;/&quot; + bd;
        return DriverManager.getConnection(cadenaConnexio, prop);
    }

    public static void main(String[] args) throws SQLException {
        Connection conn = connecta();
        Statement st = conn.createStatement(); // (3) crea un Statement
        String query = &quot;SELECT version()&quot;;     // defineix la query
        ResultSet rs = st.executeQuery(query); // (4) crea un ResultSet
        rs.next();                             // (5) recupera el resultat
        String versio = rs.getString(1);
        System.out.println(&quot;Versió: &quot; + versio);
        rs.close();                            // tanca ResultSet
        st.close();                            // tanca Statement
        conn.close();                          // tanca connexió
    }
}
</pre>
</div>
<div class="section" id="exercici-1-obtencio-de-dades-de-la-connexio">
<h3>Exercici 1. Obtenció de dades de la connexió</h3>
<p>Desenvolupa un programa que es connecti a la base de dades <em>testbd</em> i
obtingui l'adreça (<em>inet address</em>) i el port amb el que es comunica
el nostre client, i l'adreça i el port del servidor.</p>
<p><strong>Pista</strong>: Potser voldràs intentar-ho fer amb una única consulta. A la
línia 22 del codi anterior apareix <tt class="docutils literal">rs.getString(1)</tt>. Aquest <tt class="docutils literal">1</tt>
indica que el que es vol és la <strong>primera</strong> columna obtinguda.</p>
</div>
<div class="section" id="exercici-2-cadena-de-connexio-des-d-un-fitxer">
<h3>Exercici 2.* Cadena de connexió des d'un fitxer</h3>
<p>Disposar de les dades de connexió, com ara la contrasenya, a un fitxer
extern al nostre codi té els seus avantatges. Per exemple, pots deixar
el fitxer fora del control de versions i així, si estàs compartint el
codi en un lloc públic (ex. <a class="reference external" href="https://github.com/">GitHub</a>) no corres
risc de compartir <em>massa</em>.</p>
<p>Considera la api <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/util/Properties.html">java.util.Properties</a>
i, amb una mica de recerca, aconsegueix que les dades de la cadena de
connexió es recullin d'un fitxer de propietats.</p>
</div>
<div class="section" id="exercici-3-dades-de-connexio-protegides">
<h3>Exercici 3.* Dades de connexió protegides</h3>
<p>El fitxer de propietats que has preparat a l'exercici anterior
presenta el problema de que la contrasenya apareix <em>oberta</em>. Qualsevol
que tingui accés al fitxer per lectura, la pot veure. Potser fent
servir les utilitats de protecció que ofereix el sistema operatiu en
tindràs prou per &quot;garantir&quot; la seguretat, però de vegades voldràs anar
una mica més lluny.</p>
<p>Si aquest és el teu cas, considera algun sistema d'encriptació com el
que t'ofereix la llibreria com ara <a class="reference external" href="http://www.jasypt.org/">Java Simplified Encryption</a> i crea una nova versió de l'aplicació que
et permeti protegir encara més aquestes dades tan sensibles.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="notes">
<h2>Notes</h2>
<table class="docutils footnote" frame="void" id="potseraltrestambe" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Altres versions funcionaran molt probablement
sense grans canvis.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="well small">
<ul id="navigation"> 


    <li class="navigation-next">
    <a href="./jdbc-ii-model-relacional.html">
        JDBC II. Model relacional
    </a>
    </li>
</ul> 
</div>
</div>
<footer>
  <p>
  <a href=".">Apunts tècnics</a> 
  &copy; 
  <a href="http://www.gnu.org/copyleft/fdl.html">GNU FDL</a>
  per <i>Moisès Gómez Girón </i> (<img style="position:relative;top:+5px;border:0; display:inline;" src="./images/adressamoi.png">)
  amb el generador de blocs <a href="http://getpelican.com/">Pelican</a> 
  </p>
</footer>    </div>
</div>

</body>
</html>