<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Apunts tècnics: Excepcions</title>
<meta name="description" content="">
<meta name="author" content="Moisès Gómez Girón">

<!-- HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
        <script src="./theme/html5.js"></script>
    <![endif]-->

<!-- Styles -->
<link href="./theme/bootstrap.moi.css" rel="stylesheet">
<link href="./theme/local.css" rel="stylesheet">
<link href="./theme/pygments.css" rel="stylesheet">

<!-- Feeds -->
<link href="http://apuntstecnics.herokuapp.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Apunts tècnics Atom Feed" />

</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <div class="container-fluid">
            <a class="brand" href="./">[Apunts tècnics]
 Excepcions             </a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="sidebar">
        <div class="well">
            <!--
            <h3>Temes</h3>
                <ul>
                </ul>
            -->
            <h3>Categories</h3>
            <ul>
                <li ><a href="./category/dev.html">dev</a></li>
                <li ><a href="./category/eines.html">eines</a></li>
                <li class="active"><a href="./category/poo.html">poo</a></li>
                <li ><a href="./category/programacio.html">programacio</a></li>
                <li ><a href="./category/uml.html">uml</a></li>
            </ul>
            <h3>Tags</h3>
            <ul>
                <li><a href="./tag/test.html">test</a></li>
                <li><a href="./tag/programari.html">programari</a></li>
                <li><a href="./tag/c.html">C</a></li>
                <li><a href="./tag/java.html">java</a></li>
            </ul>
        </div>
    </div>

    <div class="content">
<div class='article'>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./interfaces.html">
        Interfaces
    </a>
    </li>

    <li class="navigation-top">
    <a href="./un-primer-contacte-amb-la-programacio-en-java.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./generics.html">
        Generics
    </a>
    </li>
</ul> 
</div>
    <div class="page-header"><h1>Excepcions</h1></div>
<div class="well small">
    Entrada ubicada a la categoria
    <a href="./category/poo.html">
        poo
    </a>
            amb el tag:
            <a href="./tag/java.html">java</a> 
</div>
    <div><div class="section" id="introduccio">
<h2>Introducció</h2>
<p>Aquests continguts introdueixen el mecanisme de control d'excepcions
en el llenguatge Java.</p>
<p>Els conceptes que es treballen són: control d'errors, excepcions, captura
d'excepcions (<em>try</em>/<em>catch</em>/<em>finally</em>), llançament d'excepcions (<em>throw</em>),
excepcions predefinides, creació d'excepcions personalitzades</p>
</div>
<div class="section" id="control-d-excepcions">
<h2>Control d'excepcions</h2>
<p>Una excepció és un esdeveniment (<em>event</em>) que representa una condició anormal
en l’execució d’un programa i que atura el flux normal d’execució.</p>
<p>Les excepcions permeten a les aplicacions detectar i donar resposta situacions
d’error de manera controlada (sense penjar-se)</p>
<p>Considerem l’exemple de la classe <tt class="docutils literal">Hora</tt></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hora</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Hora</span><span class="o">()</span>                   <span class="o">{</span> <span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>                <span class="o">}</span>
  <span class="kd">public</span> <span class="nf">Hora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">,</span><span class="kt">int</span> <span class="n">m</span><span class="o">,</span> <span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span> <span class="k">this</span><span class="o">.</span><span class="na">m</span><span class="o">=</span><span class="n">m</span><span class="o">;</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span><span class="o">=</span><span class="n">s</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHora</span><span class="o">()</span>            <span class="o">{</span> <span class="k">return</span> <span class="n">h</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMinut</span><span class="o">()</span>           <span class="o">{</span> <span class="k">return</span> <span class="n">m</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSegon</span><span class="o">()</span>           <span class="o">{</span> <span class="k">return</span> <span class="n">s</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span>      <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMinut</span><span class="o">(</span><span class="kt">int</span> <span class="n">m</span><span class="o">)</span>     <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">m</span><span class="o">=</span><span class="n">m</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSegon</span><span class="o">(</span><span class="kt">int</span> <span class="n">s</span><span class="o">)</span>     <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>                     <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>        <span class="o">{</span> <span class="k">return</span> <span class="n">h</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="o">+</span><span class="n">s</span><span class="o">;</span>         <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Imaginem que volem controlar que els valors que ens introdueixen els
mètodes set siguin correctes.</p>
<p>Una manera seria la següent:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span>  <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
<p>D’aquesta manera només hi acceptem hores vàlides.</p>
<p>El problema és que el programa usuari no té manera de saber que ha
introduït un valor no vàlid!</p>
<p>Una solució pot ser fer que el mètode cridat retorni informació sobre
el resultat de la seva execució:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/** retorna true si s&#39;ha assignat satisfactòriament */</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">setHora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span>  <span class="o">{</span>
  <span class="kt">boolean</span> <span class="n">correcte</span> <span class="o">=</span> <span class="o">(</span><span class="n">h</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">correcte</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span>
  <span class="k">return</span> <span class="n">correcte</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Que podem usar d’una manera similar a:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="err">«</span><span class="o">...</span><span class="err">»</span>
<span class="n">Hora</span> <span class="n">h1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hora</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">h1</span><span class="o">.</span><span class="na">setHora</span><span class="o">(</span><span class="mi">4</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Assignada l&#39;hora correctament&quot;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Error assignant l&#39;hora&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="err">«</span><span class="o">...</span><span class="err">»</span>
</pre></div>
</td></tr></table><p>Però el nostre programa s’ha fet força més llarg i menys llegible.</p>
<p>Considerem el següent codi:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">h</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">&quot;Hora.setHora(&quot;</span><span class="o">+</span><span class="n">h</span><span class="o">+</span><span class="s">&quot;) valor fora de rang&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Que usarem:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">Hora</span> <span class="n">h1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hora</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">h1</span><span class="o">.</span><span class="na">setHora</span><span class="o">(</span><span class="mi">224</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Error assignant l&#39;hora: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Aquest codi genera la sortida:</p>
<div class="highlight"><pre>Error assignant l&#39;hora: java.lang.Exception: Hora.setHora(224) valor fora de rang
</pre></div>
<p>D'aquesta manera aconseguim que els mètodes set assegurin l'hora
correcta.</p>
<p>Però, què passa amb el constructor? Tal i com el tenim es
pot crear una hora no vàlida! Doncs fem que generi una excepció si
algun paràmetre no és correcte.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="nf">Hora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">,</span><span class="kt">int</span> <span class="n">m</span><span class="o">,</span> <span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">setHora</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
    <span class="n">setMinut</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
    <span class="n">setSegon</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Totes les excepcions a Java hereten de la <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html">classe Throwable</a>.</p>
<div class="figure align-center">
<img alt="Jerarquia de la classe Throwable" src="./images/poo018.img001.throwable.png" />
</div>
<p>La funció de la classe <tt class="docutils literal">Throwable</tt> és indicar que les seves
subclasses poden ser llençades. Ja hem vist signatures de funcions amb
<tt class="docutils literal">throws</tt>, oi?</p>
<p>Podem classificar les excepcions de Java en dos tipus: les que
requereixen ser gestionades explícitament (per exemple amb un bloc
<em>try</em>/<em>catch</em>) i les que no requereixen d'aquesta gestió explícita.</p>
<p>Les excepcions que no requereixen de gestió explícita són les classes
<tt class="docutils literal">Error</tt> i <tt class="docutils literal">RuntimeException</tt> i les seves subclasses. Aquestes
excepcions representen situacions d'error del sistema de les que
normalment no s'espera que el programa es recuperi. Considera per
exemple les subclasses <tt class="docutils literal">VirtualMachineError</tt> i
<tt class="docutils literal">ClassCastException</tt> que indiquen, respectivament, que la màquina
virtual de Java s'ha trencat, i que el codi està intentant fer un
<em>cast</em> incorrecte.</p>
<p>La gestió explícita de les excepcions és revisada pel compilador.
Aquest no deixarà passar un codi que no gestioni les excepcions
adequadament. Hi ha dues maneres de gestionar una excepció:</p>
<ol class="arabic simple">
<li>envoltar el codi que pot generar una excepció en un bloc <tt class="docutils literal">try {}</tt> i
capturar l'excepció amb una clàusula <tt class="docutils literal">catch (E e)</tt> on <tt class="docutils literal">E</tt> ha de ser del
tipus d'excepció a gestionar o bé una superclasse d'aquesta (mira
l'exercici &quot;Subclasses d'Exception&quot; per a més detalls).</li>
<li>indicar al mètode que conté el codi que pot generar l'excepció, que
pot llençar (<em>throws</em>) una excepció del tipus a gestionar o bé una
superclasse d'aquesta (mira l'exercici &quot;Subclasses d'Exception&quot;
per a més detalls).</li>
</ol>
<p>Una advertència abans que comencis a pensar en usar excepcions a tort
i a dret: cal tenir present que el mecanisme de excepcions pot
representar una certa càrrega a algunes versions de la màquina virtual
de Java. Els blocs <em>try</em>/<em>catch</em> no tenen cap problema. És a dir, el seu
ús no afegeix cap sobrecàrrega important a l'execució dels teus programes. En
canvi, l'expressió <tt class="docutils literal">throw</tt> no resulta tan barata. La màquina virtual ha
de crear un <em>try</em>/<em>catch</em> apropiat en temps d'execució entre altres coses.</p>
<p>La recomanació és que llencis excepcions <em>només</em> en situacions
excepcionals, al menys quan l'eficiència sigui important. Per exemple,
si has de recórrer molts cops una llista d'elements, sovint resultarà
més eficient anar comprovant a cada iteració si en queden més que
aturar el recorregut en arribar a l'excepció.</p>
<p>Si tens curiositat pots mirar discussions com aquesta de
<a class="reference external" href="http://stackoverflow.com/questions/299068/how-slow-are-java-exceptions">stackoverflow</a>.</p>
</div>
<div class="section" id="exercicis">
<h2>Exercicis</h2>
<div class="section" id="exercici-1-hora-amb-excepcions">
<h3>Exercici 1. Hora amb excepcions</h3>
<p>Desenvolupeu la classe Hora amb control d'excepcions per tots els
mètodes que puguin generar un error. Incloeu un <tt class="docutils literal">main()</tt> que
comprovi cadascun dels mètodes que puguin generar excepcions.</p>
</div>
<div class="section" id="exercici-2-main-amb-excepcions">
<h3>Exercici 2. <tt class="docutils literal">main()</tt> amb excepcions</h3>
<p>El mètode <tt class="docutils literal">main()</tt> pot també generar excepcions. Aquestes seran
recollides per l'interpret de java</p>
<p>Substitueix la funció <tt class="docutils literal">main()</tt> del programa anterior per la següent.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">argH</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="kt">int</span> <span class="n">argM</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
        <span class="kt">int</span> <span class="n">argS</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
        <span class="n">Hora</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hora</span><span class="o">(</span><span class="n">argH</span><span class="o">,</span> <span class="n">argM</span><span class="o">,</span> <span class="n">argS</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creada l&#39;hora &quot;</span> <span class="o">+</span> <span class="n">h</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;ha capturat l&#39;excepció &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
        <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>  <span class="c1">// tornem a llençar l&#39;excepció</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;executa tant si hi ha com si no hi ha excepció&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;executa en finalitzar si no hi ha excepció&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Comprova el resultat d'executar amb diferents paràmetres: amb menys de
tres paràmetres, amb paràmetres textuals (ex. java Hora un dos tres),
amb paràmetres fora de rang, amb paràmetres correctes.</p>
<p>Descriu amb les teves paraules la funcionalitat representa la clàusula
finally{} Se t'acut alguna utilitat? Sinó, troba una per la web!</p>
<p>El codi mostra el resultat de e.toString() però hi ha més maneres
d'obtenir informació de l'excepció. Descriu amb les teves paraules què
fan els mètodes d'Exception getMessage(), getStackTrace() i
printStackTrace().</p>
<p>Fixat que el codi llença l'excepció directament amb un</p>
<div class="highlight"><pre><span class="k">throw</span> <span class="n">e</span><span class="o">;</span>  <span class="c1">// tornem a llençar l&#39;excepció</span>
</pre></div>
<p>Què passaria si substitueixes aquesta línia per la següent? (considera
la informació del constructor a la API de Java)</p>
<div class="highlight"><pre><span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">&quot;Exception capturada&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>  <span class="c1">// tornem a llençar l&#39;excepció</span>
</pre></div>
</div>
<div class="section" id="exercici-3-gat-amb-excepcions">
<h3>Exercici 3. Gat amb excepcions</h3>
<p>Crea una nova versió de la classe la classe Gat de manera que les
operacions que puguin donar lloc a error (ex. assignar un nombre de
vides negatiu) disposin d'excepcions. Modifica el programa
<tt class="docutils literal">EntornGat</tt> de manera que tracti aquestes excepcions. Considera si
cal modificar la classe <tt class="docutils literal">GatRenat</tt>.</p>
</div>
<div class="section" id="exercici-4-excepcions-amb-recursos">
<h3>Exercici 4. Excepcions amb recursos</h3>
<p>Des de la versió 7 de Java, existeix una variant d'ús del <em>try</em>. Es
diu <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try amb recursos</a> i permet especificar recursos com a arguments
de <em>try</em>. Quan fem servir aquest format, el compilador de Java afegirà
el codi necessari per tancar els recursos tant si es produeix excepció
o no.</p>
<p>El format és:</p>
<div class="highlight"><pre><span class="k">try</span> <span class="o">(</span><span class="n">llista</span> <span class="n">de</span> <span class="n">recursos</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">processament</span> <span class="n">dels</span> <span class="n">recursos</span>
<span class="o">}</span>
</pre></div>
<p>Un recurs és una instància d'una classe que implementi la interfície
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html">java.lang.AutoCloseable</a>. Per
tant, en podem fins i tot crear-ne de nous.</p>
<p>El que ens ofereix és la possibilitat de no haver de tancar el recurs.  Amb els
coneixements que ja hem vist abans, podíem resoldre-ho amb un <em>finally</em> Això
equival a</p>
<div class="highlight"><pre><span class="k">try</span> <span class="o">{</span>
    <span class="n">obrir</span> <span class="n">recursos</span>
    <span class="n">processament</span> <span class="n">dels</span> <span class="n">recursos</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">tancar</span> <span class="n">recursos</span>
<span class="o">}</span>
</pre></div>
<p>Considera el següent codi que defineix la nostra versió de la comanda
<em>cat</em>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Vector</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CatMeu</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">llegeix_fitxer</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">linies</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span>
                <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">)))</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">linia</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">linia</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">linies</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">linia</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Ops: s&#39;ha produït una excepció: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">linies</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="n">linies</span><span class="o">.</span><span class="na">size</span><span class="o">()]);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Indica un o més paràmetres&quot;</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="nl">a:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">linies</span><span class="o">[]</span> <span class="o">=</span> <span class="n">llegeix_fitxer</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">linia</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">linia</span> <span class="o">&lt;</span> <span class="n">linies</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">linia</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Línia [%d]: &#39;%s&#39;\n&quot;</span><span class="o">,</span> <span class="n">linia</span> <span class="o">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">linies</span><span class="o">[</span><span class="n">linia</span><span class="o">]);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>Pots executar aquest codi des del mateix directori on tinguis el seu
codi font, fent:</p>
<div class="highlight"><pre><span class="nv">$ </span>java CatMeu fitxerinexistent1 CatMeu.java fitxerinexistent2
</pre></div>
<p>De manera que puguis veure:</p>
<ul class="simple">
<li>dos missatges amb excepcions de fitxer o directori no existent</li>
<li>el contingut del fitxer CatMeu.java.</li>
</ul>
<div class="section" id="es-demana">
<h4>Es demana</h4>
<p>Analitza aquest codi fins que et familiaritzis amb el seu
funcionament. A continuació, desenvolupa un programa anomenat
<em>MostraImports</em> tal que:</p>
<ul>
<li><p class="first">processi la llista d'arguments que se li passin</p>
</li>
<li><p class="first">ignori sense cap missatge aquells paràmetres que no siguin fitxers
amb codi font java (per simplicitat, els que no tinguin extensió
.java)</p>
</li>
<li><p class="first">per cada fitxer .java, que mostri la llista d'imports que conté o el
missatge &quot;Cap import&quot; si no conté cap.</p>
<p>Per exemple:</p>
</li>
</ul>
<div class="highlight"><pre><span class="nv">$ </span>java MostraImports fitxerinexistent CatMeu.java
CatMeu.java:
    java.io.BufferedReader
    java.io.FileReader
    java.io.IOException
    java.util.Vector
</pre></div>
<p>Notes:</p>
<ul class="simple">
<li>fes servir el <em>try</em> amb recursos.</li>
<li>recorda que la classe <a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html">String</a> disposa de
moltes utilitats per a poder consultar i extreure parts d'un string.</li>
<li>no cal que consideris el cas <em>import static</em></li>
</ul>
</div>
</div>
<div class="section" id="exercici-5-subclasses-d-exception">
<h3>Exercici 5. Subclasses d'Exception</h3>
<p>Exception no deixa de ser una classe més i com a tal, podem trobar la
seva documentació a
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html">http://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html</a>.</p>
<p>A la secció &quot;Direct known subclasses&quot; hi trobem les subclasses
d'Exception que ens ofereix la API. Per exemple hi trobem la ja
coneguda IOException.</p>
<p>Potser trobar-ne una que sigui més propera al significat de les
nostres excepcions no sempre és fàcil ni possible. Per sort, en podem
crear de noves.</p>
<p>Considerem el següent codi:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HoraNoValidaException</span> <span class="kd">extends</span> <span class="n">Exception</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nf">HoraNoValidaException</span><span class="o">(</span><span class="n">String</span> <span class="n">missatge</span><span class="o">){</span>
    <span class="kd">super</span><span class="o">(</span><span class="s">&quot;Excepció Hora no vàlida: &quot;</span> <span class="o">+</span> <span class="n">missatge</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><p>i</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hora</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Hora</span><span class="o">()</span>                  <span class="o">{</span> <span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">Hora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">,</span><span class="kt">int</span> <span class="n">m</span><span class="o">,</span> <span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">HoraNoValidaException</span> <span class="o">{</span>
        <span class="n">setHora</span><span class="o">(</span><span class="n">h</span><span class="o">);</span>
        <span class="n">setMinut</span><span class="o">(</span><span class="n">m</span><span class="o">);</span>
        <span class="n">setSegon</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHora</span><span class="o">()</span>           <span class="o">{</span> <span class="k">return</span> <span class="n">h</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMinut</span><span class="o">()</span>          <span class="o">{</span> <span class="k">return</span> <span class="n">m</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSegon</span><span class="o">()</span>          <span class="o">{</span> <span class="k">return</span> <span class="n">s</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHora</span><span class="o">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">HoraNoValidaException</span>  <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">h</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">h</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">h</span><span class="o">=</span><span class="n">h</span><span class="o">;</span>
        <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">HoraNoValidaException</span><span class="o">(</span><span class="s">&quot;Hora.setHora(&quot;</span><span class="o">+</span><span class="n">h</span><span class="o">+</span><span class="s">&quot;) valor fora de rang&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMinut</span><span class="o">(</span><span class="kt">int</span> <span class="n">m</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">HoraNoValidaException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">m</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">m</span><span class="o">=</span><span class="n">m</span><span class="o">;</span>
        <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">HoraNoValidaException</span><span class="o">(</span><span class="s">&quot;Hora.setMinut(&quot;</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="s">&quot;) valor fora de rang&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSegon</span><span class="o">(</span><span class="kt">int</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">HoraNoValidaException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="o">&lt;</span><span class="mi">24</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">s</span><span class="o">=</span><span class="n">s</span><span class="o">;</span>
        <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">HoraNoValidaException</span><span class="o">(</span><span class="s">&quot;Hora.setSegon(&quot;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s">&quot;) valor fora de rang&quot;</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span>       <span class="o">{</span> <span class="k">return</span> <span class="n">h</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="s">&quot;:&quot;</span><span class="o">+</span><span class="n">s</span><span class="o">;</span> <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="kt">int</span> <span class="n">argH</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
            <span class="kt">int</span> <span class="n">argM</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
            <span class="kt">int</span> <span class="n">argS</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
            <span class="n">Hora</span> <span class="n">h</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hora</span><span class="o">(</span><span class="n">argH</span><span class="o">,</span> <span class="n">argM</span><span class="o">,</span> <span class="n">argS</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Creada l&#39;hora &quot;</span> <span class="o">+</span> <span class="n">h</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">HoraNoValidaException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;ha capturat una excepció d&#39;hora:: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;ha capturat una excepció no d&#39;hora:: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>  <span class="c1">// tornem a llençar l&#39;excepció</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;executa tant si hi ha com si no hi ha excepció&quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;S&#39;executa en finalitzar si no hi ha excepció&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table><div class="section" id="id1">
<h4>Es demana</h4>
<p>Crea una nova classe anomenada <tt class="docutils literal">Data</tt> que disposi dels atributs
<tt class="docutils literal">dia</tt>, <tt class="docutils literal">mes</tt> i <tt class="docutils literal">any</tt>, amb els mètodes get/set i constructors que
assegurin que tota instància creada conté una data correcta. Altrament
generarà l'excepció <tt class="docutils literal">DataNoValidaException</tt></p>
</div>
</div>
<div class="section" id="exercici-6-embolicant-una-excepcio">
<h3>Exercici 6. Embolicant una excepció</h3>
<p>Crea la classe <tt class="docutils literal">DataHora</tt> què conté una <tt class="docutils literal">Data</tt> i una <tt class="docutils literal">Hora</tt> (exercicis
anteriors) privades.</p>
<p>La classe <tt class="docutils literal">DataHora</tt> oferirà mètodes per a accedir directament als
valors de les propietats de <tt class="docutils literal">Data</tt> i de <tt class="docutils literal">Hora</tt> com si fossin seus.
En cas que es produeixi alguna excepció específica de <tt class="docutils literal">Data</tt> o de
<tt class="docutils literal">Hora</tt> en fer servir les classes dels seus atributs, la classe
<tt class="docutils literal">DataHora</tt> &quot;traduirà&quot; l'excepció a una pròpia <tt class="docutils literal">DataHoraException</tt>
que permetrà incloure l'excepció original en el seu constructor.</p>
</div>
</div>
</div>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./interfaces.html">
        Interfaces
    </a>
    </li>

    <li class="navigation-top">
    <a href="./un-primer-contacte-amb-la-programacio-en-java.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./generics.html">
        Generics
    </a>
    </li>
</ul> 
</div>
</div>
<footer>
  <p>
  <a href=".">Apunts tècnics</a> 
  &copy; 
  <a href="http://www.gnu.org/copyleft/fdl.html">GNU FDL</a>
  per <i>Moisès Gómez Girón </i> (<img style="position:relative;top:+5px;border:0; display:inline;" src="./images/adressamoi.png">)
  amb el generador de blocs <a href="http://getpelican.com/">Pelican</a> 
  </p>
</footer>    </div>
</div>

</body>
</html>