<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Apunts tècnics: Refactoring: Eliminació de variables temporals</title>
<meta name="description" content="">
<meta name="author" content="Moisès Gómez Girón">

<!-- HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
        <script src="./theme/html5.js"></script>
    <![endif]-->

<!-- Styles -->
<link href="./theme/bootstrap.moi.css" rel="stylesheet">
<link href="./theme/local.css" rel="stylesheet">
<link href="./theme/pygments.css" rel="stylesheet">

<!-- Feeds -->
<link href="http://apuntstecnics.herokuapp.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Apunts tècnics Atom Feed" />

</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <div class="container-fluid">
            <a class="brand" href="./">[Apunts tècnics]
 Refactoring: Eliminació de variables temporals             </a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="sidebar">
        <div class="well">
            <!--
            <h3>Temes</h3>
                <ul>
                </ul>
            -->
            <h3>Categories</h3>
            <ul>
                <li ><a href="./category/bd.html">bd</a></li>
                <li class="active"><a href="./category/dev.html">dev</a></li>
                <li ><a href="./category/eines.html">eines</a></li>
                <li ><a href="./category/misc.html">misc</a></li>
                <li ><a href="./category/mongodb.html">mongodb</a></li>
                <li ><a href="./category/poo.html">poo</a></li>
                <li ><a href="./category/programacio.html">programacio</a></li>
                <li ><a href="./category/uml.html">uml</a></li>
            </ul>
            <h3>Tags</h3>
            <ul>
                <li><a href="./tag/c.html">C</a></li>
                <li><a href="./tag/jdbc.html">JDBC</a></li>
                <li><a href="./tag/postgresql.html">PostGreSQL</a></li>
                <li><a href="./tag/mongodb.html">mongoDB</a></li>
                <li><a href="./tag/programari.html">programari</a></li>
                <li><a href="./tag/util.html">util</a></li>
                <li><a href="./tag/test.html">test</a></li>
                <li><a href="./tag/java.html">java</a></li>
            </ul>
        </div>
    </div>

    <div class="content">
<div class='article'>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./refactoring-moviment-de-responsabilitat.html">
        Refactoring: Moviment de responsabilitat
    </a>
    </li>

    <li class="navigation-top">
    <a href="./introduccio-al-refactoring.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./refactoring-altres-passes-de-refaccio.html">
        Refactoring: altres passes de refacció
    </a>
    </li>
</ul> 
</div>
    <div class="page-header"><h1>Refactoring: Eliminació de variables temporals</h1></div>
<div class="well small">
    Entrada ubicada a la categoria
    <a href="./category/dev.html">
        dev
    </a>
            amb els tags: 
            <a href="./tag/programari.html">programari</a> 
            <a href="./tag/java.html">java</a> 
</div>
    <div><div class="section" id="introduccio">
<h2>Introducció</h2>
<p>En aquesta entrada relitza un nou pas de refacció conegut com a
<em>eliminació de variables temporals</em>.</p>
</div>
<div class="section" id="eliminacio-de-variables-temporals">
<h2>Eliminació de variables temporals</h2>
<p>Ja hem discutit la importància d'eliminar variables temporals. Es
tracta de variables que només es poden accedir dins del mètode que les
declara i això promou la creació de mètodes més llargs i complexos.</p>
<p>A <tt class="docutils literal">Client.informe()</tt> hi ha encara variables temporals que podríem
considerar eliminar. En concret, <tt class="docutils literal">total</tt> i <tt class="docutils literal">bonificacions</tt>.</p>
<p>Fixa't que el càlcul d'aquests dos valors, serà necessari també per
realitzar <tt class="docutils literal">Client.informeHTML()</tt></p>
<p>Totes dues variables temporals acumulen valors obtinguts dels
diferents lloguers. Fixa't com, el bucle es aprofitat per realitzar
tres coses diferents:</p>
<ol class="arabic simple">
<li>composar la part de l'informe corresponent a cada lloguer</li>
<li>acumular l'import de cada lloguer</li>
<li>acumular la bonificació de cada lloguer</li>
</ol>
<p>Si bé pot semblar convenient des d'un punt de vista de rendiment,
realitzar aquestes tres coses barrejades en el mateix lloc ens està
obligant a duplicar codi a <tt class="docutils literal">Client.informeHTML()</tt>.</p>
<p>El que farem a continuació és realitzar les tres accions en
recorreguts separats. Sí, recorrerem tres cops els lloguers d'un
client. En el cas del càlcul d'imports i bonificacions, aquests
recorreguts tindran lloc en nous mètodes.</p>
<p>Si continua preocupant-te el rendiment <a class="footnote-reference" href="#rendimentstring" id="id1">[1]</a>, et proposo
que facis una prova de temps abans i després del canvi (posa un nombre
considerable de lloguers) Compara la diferència amb el que et costava
abans codificar <tt class="docutils literal">Client.informeHTML()</tt> respecte d'ara (inclou una
estimació del cost de manteniment i d'afegir noves versions com
<tt class="docutils literal">Client.informeXML()</tt>)</p>
<p>Fixa't que amb aquest canvi, la funcionalitat de calcular l'import
total i les bonificacions d'un client estan disponibles per a
qualsevol nou mètode de <tt class="docutils literal">Client</tt> que les necessiti. Encara més, si
fem públics els nous mètodes, els usuaris de la classe també en
podrien traure profit.  Planteja't com s'ho farien abans per a poder
calcular aquests valors?  Era quelcom convenient? Perquè?</p>
<div class="section" id="exercici-15-eliminacio-de-la-variable-total">
<h3>Exercici 15. Eliminació de la variable <tt class="docutils literal">total</tt></h3>
<p>Elimina la variable <tt class="docutils literal">total</tt> del codi de <tt class="docutils literal">Client.informe()</tt>. Amb la
nova versió, aquest mètode tindrà el següent aspecte:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">public</span> <span class="n">String</span> <span class="nf">informe</span><span class="o">()</span> <span class="o">{</span>
     <span class="kt">int</span> <span class="n">bonificacions</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
     <span class="n">String</span> <span class="n">resultat</span> <span class="o">=</span> <span class="s">&quot;Informe de lloguers del client &quot;</span> <span class="o">+</span>
         <span class="n">getNom</span><span class="o">()</span> <span class="o">+</span>
         <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="n">getNif</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;)\n&quot;</span><span class="o">;</span>
     <span class="k">for</span> <span class="o">(</span><span class="n">Lloguer</span> <span class="nl">lloguer:</span> <span class="n">lloguers</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">bonificacions</span> <span class="o">+=</span> <span class="n">lloguer</span><span class="o">.</span><span class="na">bonificacions</span><span class="o">();</span>
         <span class="c1">// composa els resultats d&#39;aquest lloguer</span>
         <span class="n">resultat</span> <span class="o">+=</span> <span class="s">&quot;\t&quot;</span> <span class="o">+</span>
             <span class="n">lloguer</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">().</span><span class="na">getMarca</span><span class="o">()</span> <span class="o">+</span>
             <span class="s">&quot; &quot;</span> <span class="o">+</span>
             <span class="n">lloguer</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">().</span><span class="na">getModel</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span>
             <span class="o">(</span><span class="n">lloguer</span><span class="o">.</span><span class="na">quantitat</span><span class="o">()</span> <span class="o">*</span> <span class="mi">30</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;€&quot;</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="c1">// afegeix informació final</span>
<span class="hll">     <span class="n">resultat</span> <span class="o">+=</span> <span class="s">&quot;Import a pagar: &quot;</span> <span class="o">+</span> <span class="n">importTotal</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;€\n&quot;</span> <span class="o">+</span>
</span>         <span class="s">&quot;Punts guanyats: &quot;</span> <span class="o">+</span> <span class="n">bonificacions</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
     <span class="k">return</span> <span class="n">resultat</span><span class="o">;</span>
 <span class="o">}</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="exercici-16-eliminacio-de-la-variable-bonificacions">
<h3>Exercici 16. Eliminació de la variable <tt class="docutils literal">bonificacions</tt></h3>
<p>Ara li toca el torn de la variable <tt class="docutils literal">bonificacions</tt>. Elimina-la del
codi de <tt class="docutils literal">Client.informe()</tt>. Amb la nova versió, aquest mètode tindrà
el següent aspecte:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">public</span> <span class="n">String</span> <span class="nf">informe</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">String</span> <span class="n">resultat</span> <span class="o">=</span> <span class="s">&quot;Informe de lloguers del client &quot;</span> <span class="o">+</span>
         <span class="n">getNom</span><span class="o">()</span> <span class="o">+</span>
         <span class="s">&quot; (&quot;</span> <span class="o">+</span> <span class="n">getNif</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;)\n&quot;</span><span class="o">;</span>
     <span class="k">for</span> <span class="o">(</span><span class="n">Lloguer</span> <span class="nl">lloguer:</span> <span class="n">lloguers</span><span class="o">)</span> <span class="o">{</span>
         <span class="c1">// composa els resultats d&#39;aquest lloguer</span>
         <span class="n">resultat</span> <span class="o">+=</span> <span class="s">&quot;\t&quot;</span> <span class="o">+</span>
             <span class="n">lloguer</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">().</span><span class="na">getMarca</span><span class="o">()</span> <span class="o">+</span>
             <span class="s">&quot; &quot;</span> <span class="o">+</span>
             <span class="n">lloguer</span><span class="o">.</span><span class="na">getVehicle</span><span class="o">().</span><span class="na">getModel</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span>
             <span class="o">(</span><span class="n">lloguer</span><span class="o">.</span><span class="na">quantitat</span><span class="o">()</span> <span class="o">*</span> <span class="mi">30</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;€&quot;</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
     <span class="o">}</span>

     <span class="c1">// afegeix informació final</span>
     <span class="n">resultat</span> <span class="o">+=</span> <span class="s">&quot;Import a pagar: &quot;</span> <span class="o">+</span> <span class="n">importTotal</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;€\n&quot;</span> <span class="o">+</span>
<span class="hll">         <span class="s">&quot;Punts guanyats: &quot;</span> <span class="o">+</span> <span class="n">bonificacionsTotals</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
</span>     <span class="k">return</span> <span class="n">resultat</span><span class="o">;</span>
 <span class="o">}</span>
</pre></div>
</td></tr></table><hr class="docutils" />
<p>Trobem més passes de refacció a la següent <a class="reference external" href="./refactoring-altres-passes-de-refaccio.html">entrada</a></p>
</div>
</div>
<div class="section" id="notes">
<h2>Notes</h2>
<table class="docutils footnote" frame="void" id="rendimentstring" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Qualsevol realment preocupat pel rendiment faria
bé de revisar primer la conveniència de fer servir la concatenació
de Strings.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./refactoring-moviment-de-responsabilitat.html">
        Refactoring: Moviment de responsabilitat
    </a>
    </li>

    <li class="navigation-top">
    <a href="./introduccio-al-refactoring.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./refactoring-altres-passes-de-refaccio.html">
        Refactoring: altres passes de refacció
    </a>
    </li>
</ul> 
</div>
</div>
<footer>
  <p>
  <a href=".">Apunts tècnics</a> 
  &copy; 
  <a href="http://www.gnu.org/copyleft/fdl.html">GNU FDL</a>
  per <i>Moisès Gómez Girón </i> (<img style="position:relative;top:+5px;border:0; display:inline;" src="./images/adressamoi.png">)
  amb el generador de blocs <a href="http://getpelican.com/">Pelican</a> 
    </p><p style="background:red; text-align:center;font-weight:bold;font-size:large;margin-left:30px;">Atenció: aquests continguts seran eliminats en breu. Si et cal fer còpia d'alguna pàgina, ara és un bon moment.
  </p>
</footer>    </div>
</div>

</body>
</html>
