<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Apunts tècnics: Comparació models relacional i objecte-relacionals (primera part)</title>
<meta name="description" content="">
<meta name="author" content="Moisès Gómez Girón">

<!-- HTML5 shim, for IE6-8 support of HTML elements -->
<!--[if lt IE 9]>
        <script src="./theme/html5.js"></script>
    <![endif]-->

<!-- Styles -->
<link href="./theme/bootstrap.moi.css" rel="stylesheet">
<link href="./theme/local.css" rel="stylesheet">
<link href="./theme/pygments.css" rel="stylesheet">

<!-- Feeds -->
<link href="http://apuntstecnics.herokuapp.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Apunts tècnics Atom Feed" />

</head>
<body>

<div class="topbar">
    <div class="topbar-inner">
        <div class="container-fluid">
            <a class="brand" href="./">[Apunts tècnics]
 Comparació models relacional i objecte-relacionals (primera part)             </a>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="sidebar">
        <div class="well">
            <!--
            <h3>Temes</h3>
                <ul>
                </ul>
            -->
            <h3>Categories</h3>
            <ul>
                <li class="active"><a href="./category/bd.html">bd</a></li>
                <li ><a href="./category/dev.html">dev</a></li>
                <li ><a href="./category/eines.html">eines</a></li>
                <li ><a href="./category/gui.html">gui</a></li>
                <li ><a href="./category/misc.html">misc</a></li>
                <li ><a href="./category/poo.html">poo</a></li>
                <li ><a href="./category/programacio.html">programacio</a></li>
                <li ><a href="./category/uml.html">uml</a></li>
            </ul>
            <h3>Tags</h3>
            <ul>
                <li><a href="./tag/c.html">C</a></li>
                <li><a href="./tag/postgresql.html">PostGreSQL</a></li>
                <li><a href="./tag/mongodb.html">mongoDB</a></li>
                <li><a href="./tag/programari.html">programari</a></li>
                <li><a href="./tag/util.html">util</a></li>
                <li><a href="./tag/test.html">test</a></li>
                <li><a href="./tag/java.html">java</a></li>
            </ul>
        </div>
    </div>

    <div class="content">
<div class='article'>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./primeres-passes-amb-la-consola-psql.html">
        Primeres passes amb la consola <em>psql</em>
    </a>
    </li>

    <li class="navigation-top">
    <a href="./sgbd-objecte-relacional.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./comparacio-models-relacional-i-objecte-relacionals-segona-part.html">
        Comparació models relacional i objecte-relacionals (segona part)
    </a>
    </li>
</ul> 
</div>
    <div class="page-header"><h1>Comparació models relacional i objecte-relacionals (primera part)</h1></div>
<div class="well small">
    Entrada ubicada a la categoria
    <a href="./category/bd.html">
        bd
    </a>
            amb el tag:
            <a href="./tag/postgresql.html">PostGreSQL</a> 
</div>
    <div><div class="section" id="introduccio">
<h2>Introducció</h2>
<p>Aquest document compara la modelització de dades des de dues
perspectives:</p>
<ol class="arabic simple">
<li>el model Relacional</li>
<li>el model Objecte-Relacional.</li>
</ol>
<p>Els continguts estan orientats al sistema gestor de bases de dades
objecte-relacional (SGBDOR) PostGreSQL. Tot i que les idees generals
haurien de ser traduïbles a altres SGBDOR, en l'actualitat, els
SGBDORs més importants no s'han posat d'acord en la interpretació de
les funcionalitats. Això implica que trobaràs diferències importants
depenent del fabricant.</p>
<p>Tot i que PostGreSQL ofereix un suport extens a PL/SQL, en aquests
continguts ens centrarem en el emmagatzemament de dades i deixarem de
moment la manipulació d'aquestes.</p>
<p>Aquesta és la primera part de la comparació. Hi trobaràs un breu repàs
del SQL del model relacional. La part afegida pel model
Objecte-Relacional queda a la <a class="reference external" href="./comparacio-models-relacional-i-objecte-relacionals-segona-part.html">segona part</a>.</p>
<p>Per seguir aquests continguts, es pressuposa que saps com gestionar
taules, fer consultes i inserir, modificar i eliminar-hi elements.</p>
</div>
<div class="section" id="model-relacional">
<h2>Model Relacional</h2>
<p>En aquesta secció es presenten les entitats de que es composa
l'exemple <a class="footnote-reference" href="#exempleclassic" id="id1">[1]</a> a implementar.</p>
<div class="figure align-center">
<img alt="Diagrama d'Entitat Relació del cas d'estudi" src="./images/postgresql005.img001.der.png" />
</div>
<p>Com ja saps, el model relacional guarda les dades en taules tot
cercant minimitzar redundàncies.</p>
<p>Les taules de l'exemple <a class="footnote-reference" href="#convencioder" id="id2">[2]</a> CLIENTS, COMERCIALS,
COMANDES, LINIES_COMANDA, i PRODUCTES.</p>
<p>Els atributs de cada entitat formaran les columnes de les diferents
taules.</p>
<p>Fixa't que cada part de l'adreça (carrer, codi postal, ciutat,
país) queda emmagatzemat en la seva pròpia columna. Hi ha adreces a
les taules de CLIENTS i COMANDES. Per la primera, l'adreça correspon a
la de facturació. La de COMANDES correspon a la de lliurament.</p>
<p>En el cas dels telèfons, per tenir-ne més d'un la taula CLIENTS ha de
disposar d'una columna per cada telèfon. No és massa <em>elegant</em> ja que
si en tenim menys de telèfons, hem de posar <em>nulls</em>, i si són més hem
de modificar la taula.</p>
<p>Per altra banda, el model reflexa que hi ha alguns clients que tenen
un comercial associat. Es tracta de clients importants als que
l'empresa destina un comercial. Com que un comercial pot tenir N
clients als que fa el seguiment, mentre que un client pot tenir 0 o 1
comercial associat, aquesta relació ens donarà alguns problemes a
l'hora de codificar-la en el model relacional. En concret, ens
obligarà o renunciar al control d'integritat d'una clau forana que en
alguns casos, haurà de poder ser nul, o bé a crear una taula
addicional que enllaci els clients VIPs amb el comercial associat.
Aquí optarem per aquesta via <a class="footnote-reference" href="#alternativesherencia" id="id3">[3]</a>.</p>
<p>Finalment, fixat que la relació entre la comanda i els productes
requerits, fa servir una <em>entitat feble</em> (LINIES_COMANDA) que
emmagatzema aquesta relació i afegeix alguna informació (quantitat de
producte).</p>
<div class="section" id="la-taula-clients">
<h3>La taula Clients</h3>
<p>Crearem la taula CLIENTS amb:</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CLIENTS</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">tractament</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">nom</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">cognoms</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">carrer</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">codi_postal</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">ciutat</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">pais</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">telefon_1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">telefon_2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">telefon_3</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
<p>Tot i que PostGreSQL ens ofereix el tipus SERIAL per generar una clau
primària que s'autocalculi per cada client, aquí farem servir INTEGER
per simplicitat. Si tens intenció d'afegir moltes entrades pots fer
servir BIG INTEGER.</p>
<p>No cal indicar que <em>id</em> és NOT NULL. PostGreSQL ho marca en el moment
que sap que és una clau primària.</p>
<p>També notem que la majoria de camps els declarem de tipus TEXT per no
haver-nos de preocupar per les mides. Tenint en compte que PostGreSQL
fa una implementació força eficient d'aquest tipus de dades, potser
només ens hauríem de preocupar del camp <em>tractament</em> que contindrà
valors com ara <em>Sr.</em>, <em>Sra.</em>, etc. Per simplicitat et proposo que ho
deixem així.</p>
<p>En el moment que llencis aquesta comanda, PostGreSQL respondrà amb</p>
<div class="highlight"><pre>NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index <span class="s2">&quot;clients_pkey&quot;</span> <span class="k">for </span>table <span class="s2">&quot;clients&quot;</span>
CREATE TABLE
</pre></div>
<p>Amb això ens està avisant que ha creat un índex per la taula CLIENTS.
És un element que en altres SGBDs queda amagat i que PostGreSQL
explicita perquè ofereix la possibilitat de fer-ho d'altres maneres.
Per cert, en cas que vulguis desfer-te de la taula (<tt class="docutils literal">DROP TABLE
CLIENTS;</tt>) PostGreSQL es farà càrrec també d'eliminar els índexs i
altres elements que hagi creat per tu <a class="footnote-reference" href="#compteambheretats" id="id4">[4]</a>.</p>
<p>En cas que tinguis interès en revisar la descripció de la taula que
has creat, pots fer-ho des de <tt class="docutils literal">psql</tt> amb:</p>
<div class="highlight"><pre><span class="nv">testbd</span><span class="o">=</span>&gt; <span class="se">\d</span> CLIENTS
             Table <span class="s2">&quot;public.clients&quot;</span>
   Column    |         Type          | Modifiers
-------------+-----------------------+-----------
 id          | integer               | not null
 tractament  | text                  |
 nom         | text                  |
 cognoms     | text                  |
 carrer      | text                  |
 codi_postal | character varying<span class="o">(</span>20<span class="o">)</span> |
 ciutat      | text                  |
 pais        | text                  |
 telefon_1   | character varying<span class="o">(</span>20<span class="o">)</span> |
 telefon_2   | character varying<span class="o">(</span>20<span class="o">)</span> |
 telefon_3   | character varying<span class="o">(</span>20<span class="o">)</span> |
Indexes:
    <span class="s2">&quot;clients_pkey&quot;</span> PRIMARY KEY, btree <span class="o">(</span>id<span class="o">)</span>
</pre></div>
</div>
<div class="section" id="exercici-1-la-taula-comercials">
<h3>Exercici 1. La taula COMERCIALS</h3>
<p>Implementa la taula COMERCIALS.</p>
<p>Anomena a la clau primària <tt class="docutils literal">id</tt> i declara-la exactament igual que a
CLIENTS. Això permetrà mantenir la coherència amb la resta de les
definicions que venen a continuació.</p>
</div>
<div class="section" id="els-clients-vip">
<h3>Els clients VIP</h3>
<p>Com hem comentat abans, crearem una taula addicional per enllaçar els
clients especials amb el seu comercial associat</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">VIP_COMERCIAL</span> <span class="p">(</span>
    <span class="n">id_client</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">CLIENTS</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">id_comercial</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">COMERCIALS</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="la-taula-comandes">
<h3>La taula COMANDES</h3>
<p>La taula COMANDES presenta una particularitat: la clau forana.</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">COMANDES</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">id_client</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">CLIENTS</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">data_comanda</span> <span class="k">TIMESTAMP</span><span class="p">,</span>
    <span class="n">carrer</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">codi_postal</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">ciutat</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">pais</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</pre></div>
<p>En quan a la data, fixa't que apareix com a TIMESTAMP. És una manera
eficient de guardar les dates (incloent l'hora) i PostGreSQL ens
ofereix diferents funcions per a tractar aquest tipus. Mira el <a class="reference external" href="http://www.postgresql.org/docs/9.1/static/datatype-datetime.html">manual
de TIMESTAMP</a>
per més detalls.</p>
<p>També fixat que aquesta taula també es veu obligada a disposar de
camps per cada element que forma una adreça. Probablement aquesta
sigui la mateixa que la del client, però de vegades els clients tenen
una adreça diferent per lliurar que per facturar.</p>
</div>
<div class="section" id="exercici-2-la-taula-productes">
<h3>Exercici 2. La taula PRODUCTES</h3>
<p>Implementa la taula PRODUCTES. Considera únicament que el estoc és un
INTEGER i el preu un NUMERIC(10,2) que implica valors fins a 10 dígits
(comptant decimals) i fins a dos posicions decimals.</p>
</div>
<div class="section" id="la-taula-amb-les-linies-de-comanda">
<h3>La taula amb les línies de comanda</h3>
<p>La taula LINIES_COMANDA presenta una altra particularitat, una clau
primària composta. Ho podem indicar de la següent manera:</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">LINIES_COMANDA</span> <span class="p">(</span>
    <span class="n">id_comanda</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">COMANDES</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">num</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">quantitat</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">id_producte</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">PRODUCTES</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_comanda</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="section" id="afegim-productes">
<h3>Afegim productes</h3>
<p>Inserim ara algunes dades a la taula PRODUCTES</p>
<div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10001</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10001&#39;</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">01</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10002</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10002&#39;</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">02</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10003</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10003&#39;</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">03</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10004</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10004&#39;</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">04</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10005</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10005&#39;</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">05</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10006</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10006&#39;</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">06</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10007</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10007&#39;</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">07</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">PRODUCTES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">10008</span><span class="p">,</span> <span class="s1">&#39;producte nr. 10008&#39;</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">08</span><span class="p">);</span>
</pre></div>
<p>Fixa't com els strings apareixen envoltats amb cometes simples, i els
preus separen els decimals amb punt.</p>
</div>
<div class="section" id="exercici-3-alguns-clients">
<h3>Exercici 3. Alguns clients</h3>
<p>Afegeix uns quants clients. Assegura't que hi apareixen al menys els
clients amb identificador 20001 i 20002.</p>
<p>Intenta posar dades diferents per a cada camp de cada client. Això
facilitarà molt les proves que facis.</p>
</div>
<div class="section" id="exercici-4-algunes-comandes">
<h3>Exercici 4. Algunes comandes</h3>
<p>Inserirem ara algunes comandes. En concret, volem com a mínim tres.
Una pel client 20001 i dues pel client 20002.</p>
<p>Aquí tens la primera &quot;de regal&quot;</p>
<div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">COMANDES</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">30001</span><span class="p">,</span> <span class="mi">20001</span><span class="p">,</span> <span class="s1">&#39;2013-01-01 12:01:01&#39;</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">);</span>
</pre></div>
<p>Fixa't com introdueix la data. En realitat PostGreSQL accepta molts
formats per introduir dates. Fem servir aquest perquè resulta clar.</p>
<p>Per altra banda, està inserint el valor NULL als camps de l'adreça.
Podem suposar que l'aplicació que faci servir aquesta base de dades
considerarà que NULL aquí implica la mateixa adreça que apareix al
client.</p>
<p>Completa les insercions que falten. Intenta que al menys una d'elles
no correspongui a la mateixa adreça (és a dir, no contingui NULLs)</p>
<p>Finalment afegeix algunes línies de comanda per cada comanda, de
manera que tinguis comandes amb una, dues i més de dues línies. Ja
que tens prou productes, intenta no repetir-ne cap a una mateixa
comanda.</p>
</div>
<div class="section" id="exercici-5-alguns-clients-vip">
<h3>Exercici 5. Alguns clients VIP</h3>
<p>Insereix un comercial amb identificador 40001 i associa'l al client
20001.</p>
</div>
<div class="section" id="algunes-consultes">
<h3>Algunes consultes</h3>
<p>En el model relacional, les consultes (<em>queries</em>) es realitzen amb la
commanda SELECT.</p>
<p>Alguns exemples:</p>
<ul class="simple">
<li>Llista de les quantitats de producte que ha comprat els tres clients
que més n'han comprat:</li>
</ul>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">nom</span> <span class="k">AS</span> <span class="n">client</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">nom</span> <span class="k">AS</span> <span class="n">producte</span><span class="p">,</span> <span class="n">l</span><span class="p">.</span><span class="n">quantitat</span>
<span class="k">FROM</span> <span class="n">CLIENTS</span> <span class="k">AS</span> <span class="k">c</span><span class="p">,</span> <span class="n">COMANDES</span> <span class="k">AS</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">PRODUCTES</span> <span class="k">AS</span> <span class="n">p</span><span class="p">,</span> <span class="n">LINIES_COMANDA</span> <span class="k">AS</span> <span class="n">l</span>
<span class="k">WHERE</span>   <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id_client</span>        <span class="k">AND</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">id_comanda</span>   <span class="k">AND</span>
        <span class="n">l</span><span class="p">.</span><span class="n">id_producte</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">l</span><span class="p">.</span><span class="n">quantitat</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
<ul class="simple">
<li>Llista de l'import total que cada client ha comprat</li>
</ul>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">nom</span> <span class="k">AS</span> <span class="n">client</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">quantitat</span><span class="o">*</span><span class="n">p</span><span class="p">.</span><span class="n">preu</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total</span>
<span class="k">FROM</span> <span class="n">CLIENTS</span> <span class="k">AS</span> <span class="k">c</span><span class="p">,</span> <span class="n">COMANDES</span> <span class="k">AS</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">PRODUCTES</span> <span class="k">AS</span> <span class="n">p</span><span class="p">,</span> <span class="n">LINIES_COMANDA</span> <span class="k">AS</span> <span class="n">l</span>
<span class="k">WHERE</span>   <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id_client</span>        <span class="k">AND</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">l</span><span class="p">.</span><span class="n">id_comanda</span>   <span class="k">AND</span>
        <span class="n">l</span><span class="p">.</span><span class="n">id_producte</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
<ul class="simple">
<li>llista de clients amb més d'una comanda</li>
</ul>
<div class="highlight"><pre>  <span class="k">SELECT</span>  <span class="n">nom</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="n">cognoms</span> <span class="k">AS</span> <span class="n">client</span>
  <span class="k">FROM</span>    <span class="n">clients</span>
  <span class="k">WHERE</span>   <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span>
              <span class="k">SELECT</span>   <span class="n">id_client</span>
              <span class="k">FROM</span>     <span class="n">comandes</span>
              <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id_client</span>
              <span class="k">HAVING</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
          <span class="p">);</span>

<span class="n">Fixa</span><span class="s1">&#39;t en l&#39;</span><span class="err">ú</span><span class="n">s</span> <span class="n">de</span> <span class="o">``||``</span> <span class="n">per</span> <span class="n">concatenar</span> <span class="n">strings</span><span class="p">.</span>
</pre></div>
<ul class="simple">
<li>Llista dels clients VIPs amb el seu comercial associat</li>
</ul>
<div class="highlight"><pre><span class="k">SELECT</span>  <span class="n">CLIENTS</span><span class="p">.</span><span class="n">cognoms</span> <span class="o">||</span> <span class="s1">&#39;, &#39;</span> <span class="o">||</span> <span class="n">CLIENTS</span><span class="p">.</span><span class="n">nom</span> <span class="k">AS</span> <span class="n">client</span><span class="p">,</span>
        <span class="n">COMERCIALS</span><span class="p">.</span><span class="n">nom</span>
<span class="k">FROM</span>    <span class="n">CLIENTS</span><span class="p">,</span> <span class="n">COMERCIALS</span><span class="p">,</span> <span class="n">VIP_COMERCIAL</span>
<span class="k">WHERE</span>   <span class="n">CLIENTS</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">VIP_COMERCIAL</span><span class="p">.</span><span class="n">id_client</span>
  <span class="k">AND</span>   <span class="n">COMERCIALS</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">VIP_COMERCIAL</span><span class="p">.</span><span class="n">id_comercial</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="exercici-6-els-clients-de-barcelona">
<h3>Exercici 6. Els clients de Barcelona</h3>
<p>Dissenya una consulta que retorni totes les dades dels clients de la
ciutat de Barcelona.</p>
</div>
<div class="section" id="exercici-7-els-clients-amb-un-segon-telefon">
<h3>Exercici 7. Els clients amb un segon telèfon</h3>
<p>Dissenya una consulta que retorni totes les dades dels clients que
tinguin definit el segon telèfon (camp <em>telefon_2</em>).</p>
<p><em>Atenció</em>: considerarem que un telèfon no està definit per un de dos
motius: perquè valgui NULL o pergue valgui la cadena buida ('').</p>
<p>Pista: <em>IS [NOT] NULL</em></p>
</div>
<div class="section" id="exercici-8-adreces-diferents">
<h3>Exercici 8. Adreces diferents</h3>
<p>Dissenya una consulta que retorni totes les comandes que tinguin
l'adreça de lliurament diferent de la de facturació del client
corresponent.</p>
<p>La consulta tornarà només els identificadors de client i de comanda.
El resultat generat reanomenarà els resultats amb <em>client_nr</em> i
<em>comanda_nr</em>.</p>
<p>Pista: <em>AS</em></p>
</div>
<div class="section" id="exercici-9-el-millor-client">
<h3>Exercici 9. ★ El millor client</h3>
<p>Dissenya una consulta que retorni el nom i cognoms del client que ens
hagi fet més despesa (import total de totes les seves comandes).</p>
<p>Nota: aquesta consulta és una mica més complexa que les anteriors, eh?</p>
</div>
<div class="section" id="exercici-10-el-producte-mes-comprat">
<h3>Exercici 10. ★ El producte més comprat</h3>
<p>Dissenya una consulta que retorni el nom del producte més comprat.</p>
<p>Nota: aquesta consulta és també una mica més complexa, eh?</p>
</div>
<div class="section" id="exercici-11-modifiquem-dades">
<h3>Exercici 11. Modifiquem dades</h3>
<p>Defineix una comanda que modifiqui el segon telèfon i el codi postal
del client 20001 a les dades teves.</p>
<p>Encara que no te'n recordis de la sintaxi concreta, no t'hauria de ser
difícil de trobar.</p>
</div>
<div class="section" id="exercici-12-eliminem-dades">
<h3>Exercici 12. Eliminem dades</h3>
<p>Defineix una comanda sql que elimini tots els productes que no
apareguin a cap comanda i tinguin un preu superior a 10.07.</p>
<p>Encara que no te'n recordis de la sintaxi concreta, no t'hauria de ser
difícil de trobar.</p>
</div>
<div class="section" id="exercici-13-comandes-dificils">
<h3>Exercici 13. Comandes difícils</h3>
<p>Defineix les especificacions d'un mínim de 5 comandes sql <strong>no
trivials</strong> sobre aquest model de dades, i proporciona al menys una
solució per cadascuna.</p>
<p>Crea un informe en el que aparegui el contingut de les diferents
taules implicades a les teves comandes i, per cadascuna, indica
quina és la sortida que t'ha donat.</p>
<p>Et poso exemples d'algunes especificacions de companys anteriors. No
t'hi has de basar, però potser et serveixen d'inspiració
<a class="footnote-reference" href="#potserlesteves" id="id5">[5]</a>.</p>
<ul class="simple">
<li>id del client que ha comprat més productes diferents (productes amb
diferent id)</li>
<li>comptar quantes comandes tenen més d'una linia de comanda.</li>
<li>Algunes comandes tenen camps de direcció buit i volem completar-los
per tant caldrà obtenir la informació del client.  Volem el nom,
cognom i tractament (en un format més llegible) i telefons dels
clients que tinguin alguna comanda amb algun camp buit, inclourem la
id de la comanda també.  Cal endreçar els resultats per la id del
client i en cas de tenir més d'una comanda per client, per la id de
comanda.</li>
<li>Mostra el nom del comercial i la suma dels diners gastats pels
clients de cada comercial durant els últims 30 dies endreçats de mes
a menys.</li>
<li>Mostrar els clients (id i ciutat) que hagin comprat menys de 6
unitats (o cap unitat) de productes que valguin menys de 5€. Cal
mostrar també aquells clients que no hagin comprat cap unitat de
productes de menys de 5€.</li>
<li>Som el responsable de l'empresa. Les nostres ventes estan baixant i
els plans d'acció que hem aplicat no han donat resultat. Hem de
començar a pensar en reduir la nostra plantilla de comercials. És
per això que es demana una query que ens retorni: els comercials (id
i nom complet) que tinguin clients que que no hagin fet cap compra
en la darrera setmana, i també els comercials amb clients que hagin
fet compres en la darrera setmana però l'import total de totes les
compres no superi els 50€.</li>
<li>Presentar en dos registros en formato horizontal.  En el primer
registro mostrar cuantos productos se han vendido con el precio
mayor que la media de los productos vendidos. En el caso de
encontrar más de una vez el mismo producto solo se contará una vez.
En el segundo registro presentar todos los datos de la tabla
&quot;productes&quot;, de aquellos productos seleccionados en el primer caso.</li>
</ul>
</div>
<div class="section" id="exercici-14-opcional-les-consultes-d-anys-anteriors">
<h3>Exercici 14. (opcional) Les consultes d'anys anteriors</h3>
<p>Prova de resoldre les consultes dels companys d'anys anteriors.</p>
</div>
</div>
<div class="section" id="notes">
<h2>Notes</h2>
<table class="docutils footnote" frame="void" id="exempleclassic" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Sí, es tracta de l'exemple clàssic que segurament
ja has trobat a més d'un lloc. Recorda, és més fàcil entendre nous
conceptes fent servir contexts coneguts.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="convencioder" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><p class="first">En aquest document es fan servir algunes
convencions en els noms per evitar confusions amb la modelització en
classes. En particular, els noms de les entitats/taules apareix en
majúscules i plural (CLIENTS implica una taula que conté un conjunt
de clients) A banda, les claus primàries a cada entitat es diuen
simplement <em>id</em> mentre que les forànees porten com a sufix el nom
de l'entitat (aquest cop en singular i minúscules)</p>
<p class="last">Trobaràs defensors de diferents convencions, i potser tu ja tens la
teva manera favorita d'anomenar les coses. Et recomano però que, al
menys per serguir aquests exemples, facis servir aquestes
que et proposo.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="alternativesherencia" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Si en comptes d'una referència a una altra
entitat, haguéssim hagut simplement de posar un valor com ara un
string amb el nom del comercial, o bé només ens calgués aquí les
dades del comercial (no hi hagués cap altra taula amb una una
forana a COMERCIALS) ho haguéssim resolt segurament amb valors
nuls.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="compteambheretats" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Amb la versió que estem fent servir aquí, és
possible que no funcioni automàticament amb casos menys provats com
per exemple amb l'herència.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="potserlesteves" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td>Potser et pensaràs que són les consultes més
<em>xungues</em> que em van lliurar. En realitat les he escollides a
l'atzar! T'imagines mirar d'aquí uns anys aquests materials i
trobar-te una de les teves consultes?</td></tr>
</tbody>
</table>
</div>
</div>
<div class="well small">
<ul id="navigation"> 
    <li class="navigation-prev">
    <a href="./primeres-passes-amb-la-consola-psql.html">
        Primeres passes amb la consola <em>psql</em>
    </a>
    </li>

    <li class="navigation-top">
    <a href="./sgbd-objecte-relacional.html">
        inici
    </a>
    </li>

    <li class="navigation-next">
    <a href="./comparacio-models-relacional-i-objecte-relacionals-segona-part.html">
        Comparació models relacional i objecte-relacionals (segona part)
    </a>
    </li>
</ul> 
</div>
</div>
<footer>
  <p>
  <a href=".">Apunts tècnics</a> 
  &copy; 
  <a href="http://www.gnu.org/copyleft/fdl.html">GNU FDL</a>
  per <i>Moisès Gómez Girón </i> (<img style="position:relative;top:+5px;border:0; display:inline;" src="./images/adressamoi.png">)
  amb el generador de blocs <a href="http://getpelican.com/">Pelican</a> 
  </p>
</footer>    </div>
</div>

</body>
</html>